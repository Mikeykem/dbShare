<section data-ng-controller="DatabasesController" data-ng-init="find()">
    <div class="page-header">
        <h1>Databases</h1>
    </div>
<!--     <h5>Search by:</h5> 
    <select ng-model="searchKey" style="margin-bottom: 10px;">
        <option value="$" selected="selected"> Any </option>
        <option value="name" id="nameChoice"> Name </option>
        <option value="descriptionShort" id="descChoice"> Short Description </option> 
    </select> -->

<!--     <div class="input-group input-group-sm" style="margin-bottom:10px">
         Search: <input id="query" ng-model="query[searchKey]" class="form-control" placeholder = "Filter Criteria">
    </div>
 -->
<!--     <div class="input-group input-group-sm" style="margin-bottom:10px">
         Search: <input id="query" ng-model="query" class="form-control" placeholder = "Filter Criteria">
    </div>



    <table class = "table table-striped table-bordered table-hover table-condensed">
        <col width = "30">
        <col width = "250">
        <col width = "900">
        <col width = "100">
        <col width = "100">
        <tr> 
            <th>Add/Remove</th>
            <th><a href="" ng-click="predicate = 'name'; reverse=!reverse">Name</th>
            <th><a href="" ng-click="predicate = 'descriptionShort'; reverse=!reverse">Description</th>
            <th><a href="" ng-click="predicate = 'created'; reverse=!reverse">Posted On</th>
            <th><a href="" ng-click="predicate = 'user.displayName'; reverse=!reverse">Posted By</th>
        </tr>
        <tr data-ng-repeat="database in databases | orderBy: predicate : reverse | filter:query" >
            <td>
                <div>
             <script type="text/ng-template" id="addDBModal">
                <div class="modal-header">
                    <button type="button" class="close" ng-click="$dismiss()">&times;</button>
                    <h3 class="modal-title"> Add Database to Portfolio </h3>
                </div>
                    <div class="modal-body">
                        <p>You are adding &quot{{database.name}}&quot created by {{database.user.displayName}} to your portfolio.</p>
                        <div class="checkbox">
                        <label> 
                            <input type="checkbox" data-ng-model="proficient" id="proficient" unchecked>

                            I am proficient with this database and am willing to answer questions about it.
                        </label>
                    </div>
                        <button class="btn large btn-success" data-ng-click="addDatabaseToPortfolio({{database}}, proficient)">Add Database to Porfolio</button>
                        <button class="btn" ng-click="cancel()">Cancel</button>
                </div>
        </script>
    </div>

                <button style = "vertical-align: center; margin-left: 25px" ng-show="checkForDatabaseInPortfolio({{database}})" data-ng-click="open('md', database)" class="btn addDatabases"><i class="glyphicon glyphicon-plus"></i></button> 
                <button style = "vertical-align: center; margin-left: 25px" ng-show="!checkForDatabaseInPortfolio({{database}})" data-ng-click="removeDatabaseFromPortfolio({{database}})" class="btn removeDatabase"><i class="glyphicon glyphicon-minus"></i></button>
            </td>
            <td><a data-ng-href="#!/databases/{{database._id}}" class="list-group-item" id="dbClick"> {{database.name}} </td>
            <td>{{database.descriptionShort}}</td>
            <td>{{database.created | date:'shortDate'}}</td>
            <td>{{database.user.displayName}}</td>

    </table>

    <div class="alert alert-warning text-center" data-ng-hide="!databases.$resolved || databases.length">
        No databases yet, why don't you <a href="/#!/databases/create">create one</a>?
    </div>


    <a href="/#!/databases/create" data-ng-show="databases.length">
        <button type="submit" class="btn btn-primary">Create New Database</button>
    </a>

 -->





    <div class="box-col">
      <div kendo-splitter
           k-panes="[ null, null,null]"
           size: "100%" 
           style="height:900px"
           >

            <div style="width:200px">
            

                             <table class = "table table-striped table-bordered table-hover table-condensed">
                            <tr> 
                                <th>Add/Remove</th>
                                <th><a href="" ng-click="predicate = 'name'; reverse=!reverse">Name</th>
                                <th><a href="" ng-click="predicate = 'user.displayName'; reverse=!reverse">Posted By</th>
                            </tr>
                            <tr data-ng-repeat="database in databases | orderBy: predicate : reverse | filter:query" >

                                <td>
                                    <div>
                                         <script type="text/ng-template" id="addDBModal">
                                            <div class="modal-header">
                                                <button type="button" class="close" ng-click="$dismiss()">&times;</button>
                                                <h3 class="modal-title"> Add Database to Portfolio </h3>
                                            </div>
                                                <div class="modal-body">
                                                    <p>You are adding &quot{{database.name}}&quot created by {{database.user.displayName}} to your portfolio.</p>
                                                    <div class="checkbox">
                                                        <label> 
                                                            <input type="checkbox" data-ng-model="proficient" id="proficient" unchecked>

                                                            I am proficient with this database and am willing to answer questions about it.
                                                        </label>
                                                     </div>
                                                <button class="btn large btn-success" data-ng-click="addDatabaseToPortfolio({{database}}, proficient)">Add Database to Porfolio</button>
                                                <button class="btn" ng-click="cancel()">Cancel</button>
                                                </div>
                                        </script>
                                    </div>

                                    <button style = "vertical-align: center; margin-left: 25px" ng-show="checkForDatabaseInPortfolio({{database}})" data-ng-click="open('md', database)" class="btn addDatabases"><i class="glyphicon glyphicon-plus"></i></button> 
                                    <button style = "vertical-align: center; margin-left: 25px" ng-show="!checkForDatabaseInPortfolio({{database}})" data-ng-click="removeDatabaseFromPortfolio({{database}})" class="btn removeDatabase"><i class="glyphicon glyphicon-minus"></i></button>
                                </td>
                                <td><a href="" ng-click=" setDatabase(database) " class="list-group-item" id="dbClick"> {{database.name}} </td>
                                <td>{{database.user.displayName}}</td>
                            </tr>
                        </table>

                        <div class="alert alert-warning text-center" data-ng-hide="!databases.$resolved || databases.length">
                            No databases yet, why don't you <a href="/#!/databases/create">create one</a>?
                        </div>

                        <!--Button for database creation that shows up if there are databases present -->
                        <a href="/#!/databases/create" data-ng-show="databases.length">
                            <button type="submit" class="btn btn-primary">Create New Database</button>
                        </a>


            </div>




            <div style="width:600px">



                        <!-- Name Here -->
                        <div class="page-header" style="margin-bottom:3px;">
                            <h1 id="DBName" style="margin-bottom:3px">{{database.name}}</h1>
                        </div>

                        <div class="row">
                            <div class="col-xs-12 col-sm-6 col-md-8" >
                                <small style="margin-top:0px;">
                                    <em class="text-muted">
                                        Added on
                                        <span data-ng-bind="database.created | date:'mediumDate'"></span>
                                        by
                                        <span data-ng-bind="database.user.displayName"></span>
                                    </em>
                                </small>  
                            
                            <!-- Short Description Here, should this be visibile in view DB or just in the list of DBs? -->
                                <div class="page-header">
                                    <h3>Brief Description</h3>
                                    <p data-ng-bind="database.descriptionShort"></p>
                                </div>
                            
                            <!-- Long Description Here -->
                                <div class="page-header">
                                    <h3>Full Description</h3>
                                    <p data-ng-bind="database.descriptionLong"></p>
                                </div>
                           
                            <!-- URL is here -->
                                <div class="page-header">
                                    <h3>Where to Access</h3>
                                    <a data-ng-bind="database.url" ng-href="{{database.url}}"></a>
                                </div>
                            
                            <!-- isFree Here, desperately needs formatting -->
                                <div class="page-header" data-ng-show="database.isFree">
                                    <h3>Free to Access</h3>
                                    <p>This database is free to access.</p>
                                </div>
                            
                            <!-- Buttons for Delete / Edit -->
                                <div class="" data-ng-show="authentication.user._id == database.user._id || isAdmin()">
                                    <a class="btn btn-primary" id="editButton" href="/#!/databases/{{database._id}}/edit">
                                        <i class="glyphicon glyphicon-edit"></i>
                                    </a>
                                    <a class="btn btn-primary" id="delButton" data-ng-click="remove();">
                                     <i class="glyphicon glyphicon-trash"></i>
                                    </a>
                               </div>
                            </div>

                        <!-- Users who have added-->
                            <div class="col-xs-6 col-md-4" style="max-width:300px;float:right">
                                <div class="page-header">
                                    <h3>Database Users</h3>
                                </div>
                                <li data-ng-repeat="user in dbUsers" class="list-group-item">
                                    <div style="display:flex">
                                        <a class="list-group-item-text" data-ng-href="#!/users/{{user._id}}" id="attributes" style="max-width: 350px;">
                                            <span class="list-group-item-heading" data-ng-bind="user.firstName"></span>
                                            <span class="list-group-item-heading" data-ng-bind="user.lastName"></span>
                                            <span class="glyphicon glyphicon-star" style="color:#ffcc00" ng-show="isProficient({{user.proficientpors}},database._id)"></span>
                                        </a>
                                    </div>
                                </li>
                                <div class="page-footer">
                             <h6>Star denotes users who are knowledgeable of the database.</h6>
                         </div>
                            </div>
                        </div>
                        <br>
                        <br>
                        <!--Comments/Code Area-->
                        <div class="tabbable tabs-below">
                            <ul class="nav nav-pills">
                                <li ng-class="{active: selectedTab == 1}">
                                    <a href="#" ng-click="selectedTab = 1;">Comments</a>
                                </li>
                                <li ng-class="{active: selectedTab == 2}">
                                    <a href="#" ng-click="selectedTab = 2;">New Comment</a>
                                </li>
                                <li ng-class="{active: selectedTab == 3}">
                                    <a href="#" ng-click="selectedTab = 3;">Code Snippets</a>
                                </li>
                                <li ng-class="{active: selectedTab == 4}">
                                    <a href="#" ng-click="selectedTab = 4;">New Code Snippet</a>
                                </li>
                            </ul>

                            <!--Comments section-->
                            <div class="tab-content" ng-show="selectedTab == 1">
                                <div class="list-group">
                                    <li data-ng-controller="CommentsController" data-ng-repeat="comment in dbComments" class="list-group-item">
                                        <b><a data-ng-href="#!/users/{{comment.user._id}}" data-ng-bind="comment.user.displayName"></a></b>
                                        <small class="list-group-item-test"> on <span data-ng-bind="comment.created | date:'medium'"></span>
                                            
                                        <!--Delete Comment Button-->
                                        <i class="glyphicon glyphicon-remove" id="delComment" ng-show="authentication.user._id === comment.user._id || authentication.user.roles.indexOf('admin') !== -1" style="color:red; cursor: pointer" ng-click="remove(comment); getComments(database._id);"></i>                
                                        <h5 class="list-group-item-heading" data-ng-bind="comment.reviews" style="padding-top:4px"></h5>
                                    </li>
                                </div>

                                <div class="alert alert-warning text-center" ng-show="dbComments.length === 0">
                                    No comments yet.
                                </div>
                            </div>

                            <!--New Comment form-->
                            <div class="tab-content" ng-show="selectedTab == 2">
                                <form class="form-horizontal" data-ng-controller="CommentsController" novalidate data-ng-submit="create(database._id); getComments(database._id); resetCommentField()">
                                    <fieldset>
                                        <div class="form-group">
                                            <label class="control-label" for="reviews" style="padding-left:10px">Add Comment</label>
                                            <div class="controls">
                                                <textarea type="text" data-ng-model="reviews" id="reviews" class="form-control" style="margin-left:10px; max-width:700px;" placeholder="Enter your comment here" required></textarea>
                                            </div>   
                                        </div>
                                        <div class="form-group">
                                            <input type="submit" class="btn btn-default" id="commentSubmit" style="margin-left:10px;">
                                        </div>    
                                        <div data-ng-show="error" class="text-danger">
                                            <strong data-ng-bind="error"></strong>
                                        </div>
                                    </fieldset>
                                </form>
                            </div>

                            <!--Code Snippets section-->
                            <div class="tab-content" ng-show="selectedTab == 3" id="snippetList">

                                <div class="list-group">
                                    <li data-ng-controller="CodeSnippetsController" ng-repeat="codeSnippet in dbCodeSnippets" class = "list-group-item">
                                        <b><a data-ng-href="#!/users/{{codeSnippet.user._id}}" data-ng-bind="codeSnippet.user.displayName"></a></b>
                                        <small class="list-group-item-test"> on <span data-ng-bind="codeSnippet.created | date:'medium'"></span>
                                        <!--Add delete button-->
                                        <section class="codeMirrorSection">
                                            <div ui-codemirror="cmOption2" ng-model="codeSnippet.code" ui-refresh="selectedTab == 3"></div>
                                        </section>
                                    </li>
                                </div>

                                <div class="alert alert-warning text-center" ng-show="dbCodeSnippets.length === 0">
                                    No Code Snippets on this Database
                                </div>

                            </div>

                            <!--New code snippet form-->
                            <div class="tab-content" ng-show="selectedTab == 4">
                                <!-- Form (w/ new Code Mirror controller) to add code snippets to a specific database -->
                                <form class="form-horizontal" data-ng-controller="CodeSnippetsController" novalidate data-ng-submit="create(database._id); getCodeSnippets(database._id); resetCodeSnippetField()">
                                    <fieldset>
                                        <div class="form-group">
                                            <label class="control-label" for="reviews" style="padding-left:10px">Add Comment</label>
                                            <div class="controls">
                                                <section class="codeMirrorSection" >
                                                    <div ui-codemirror="cmOption1" ng-model="cmModel"></div>
                                                </section>
                                                <label class="control-label" style="padding-left:10px">Mode</label>
                                                <select class="mode-button  ng-valid ng-dirty" style="margin-left:10px; max-width:700px;" ng-model="mode" ng-options="m for m in modes" ng-change="modeChanged()"></select>
                                            </div>   
                                        </div>
                                        <div class="form-group">
                                            <input type="submit" class="btn btn-default" id="codeSnippetSubmit" style="margin-left:10px;">
                                        </div>    
                                        <div data-ng-show="error" class="text-danger">
                                            <strong data-ng-bind="error"></strong>
                                        </div>
                                    </fieldset>
                                </form>
                            </div>




            </div>

            <div>
            
            </div>

        </div>

    </div>



</section>
